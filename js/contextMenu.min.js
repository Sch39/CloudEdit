(function(e,d,a,f){e.fn.contextMenu=function(j,g,i){if(!b[j]){i=g;g=j;j="popup"}else{if(g){if(!((g instanceof Array)||(typeof g==="string")||(g.nodeType)||(g.jquery))){i=g;g=null}}}if((g instanceof Array)&&(j!="update")){j="menu"}var h=i;if(j!="update"){i=c.optionOtimizer(j,i);h=e.extend({},e.fn.contextMenu.defaults,i);if(!h.baseTrigger){h.baseTrigger=this}}b[j].call(this,g,h);return this};e.fn.contextMenu.defaults={triggerOn:"click",displayAround:"cursor",mouseClick:"left",verAdjust:0,horAdjust:0,top:"auto",left:"auto",closeOther:true,containment:d,winEventClose:true,sizeStyle:"auto",position:"auto",onOpen:function(h,g){},afterOpen:function(h,g){},onClose:function(h,g){}};var b={menu:function(g,i){var h=e(this);g=c.createMenuList(h,g,i);c.contextMenuBind.call(this,g,i,"menu")},popup:function(g,h){e(g).addClass("iw-contextMenu");c.contextMenuBind.call(this,g,h,"popup")},update:function(g,i){var h=this;this.each(function(){var r=e(this),p=r.data("iw-menuData");if(!p){h.contextMenu("refresh");p=r.data("iw-menuData")}var l=p.menu;if(typeof g==="object"){for(var n=0;n<g.length;n++){var j=g[n].name,o=g[n].disable,q=l.children("li").filter(function(){return e(this).contents().filter(function(){return this.nodeType==3}).text()==j}),m=g[n].subMenu;if(o=="true"){q.addClass("iw-mDisable")}else{q.removeClass("iw-mDisable")}if(m){q.contextMenu("update",m)}}}c.onOff(l);p.option=e.extend({},p.option,i);r.data("iw-menuData",p);var k=p.option.triggerOn;if(i){if(k!=i.triggerOn){r.unbind(".contextMenu");r.bind(k+".contextMenu",c.eventHandler)}}})},refresh:function(){var h=this.filter(function(){return !!e(this).data("iw-menuData")}).data("iw-menuData"),g=this.filter(function(){return !e(this).data("iw-menuData")});h.option.baseTrigger=this;c.contextMenuBind.call(g,h.menuSelector,h.option)},close:function(){var g=this.data("iw-menuData");if(g){c.closeContextMenu(g.option,this,g.menu,null)}},value:function(g){var h=this.data("iw-menuData");if(h[g]){return h[g]}else{if(h.option){return h.option[g]}}return null},destroy:function(){this.each(function(){var g=e(this),j=g.data("iw-menuData").menuId,i=e(".iw-contextMenu[menuId="+j+"]"),h=i.data("iw-menuData");if(!h){return}if(h.noTrigger==1){if(i.hasClass("iw-created")){i.remove()}else{i.removeClass("iw-contextMenu "+j).removeAttr("menuId").removeData("iw-menuData");i.find("li.iw-mTrigger").contextMenu("destroy")}}else{h.noTrigger--;i.data("iw-menuData",h)}g.unbind(".contextMenu").removeClass("iw-mTrigger").removeData("iw-menuData")})}};var c={contextMenuBind:function(l,m,g){var k=this,j=e(l),n=j.data("iw-menuData");if(j.length==0){j=k.find(l);if(j.length==0){return}}if(g=="menu"){c.menuHover(j)}var p=m.baseTrigger;if(!n){var o;if(!p.data("iw-menuData")){o=Math.ceil(Math.random()*100000);p.data("iw-menuData",{menuId:o})}else{o=p.data("iw-menuData").menuId}var h=j.clone();h.appendTo("body");n={menuId:o,menuWidth:h.outerWidth(true),menuHeight:h.outerHeight(true),noTrigger:1,trigger:k};j.data("iw-menuData",n).attr("menuId",o);h.remove()}else{n.noTrigger++;j.data("iw-menuData",n)}k.addClass("iw-mTrigger").data("iw-menuData",{menuId:n.menuId,option:m,menu:j,menuSelector:l,method:g});var i;if(m.triggerOn=="hover"){i="mouseenter";if(p.index(k)!=-1){p.add(j).bind("mouseleave.contextMenu",function(q){if(e(q.relatedTarget).closest(".iw-contextMenu").length==0){e('.iw-contextMenu[menuId="'+n.menuId+'"]').hide(100)}})}}else{i=m.triggerOn}k.bind(i+".contextMenu",c.eventHandler);j.bind("click mouseenter",function(q){q.stopPropagation()})},eventHandler:function(M){M.preventDefault();var C=e(this),n=C.data("iw-menuData"),i=n.menu,p=i.data("iw-menuData"),y=n.option,K=y.containment,x={trigger:C,menu:i},J=K==d,u=y.baseTrigger.index(C)==-1;if(!u&&y.closeOther){e(".iw-contextMenu").css("display","none")}i.find(".iw-mSelected").removeClass("iw-mSelected");y.onOpen.call(this,x,M);var z=e(K),l=z.innerHeight(),O=z.innerWidth(),F=0,w=0,E=p.menuHeight,h=p.menuWidth,k,q,m=0,B=0,A,G,v=k=parseInt(y.verAdjust),I=q=parseInt(y.horAdjust);if(!J){F=z.offset().top;w=z.offset().left;if(z.css("position")=="static"){z.css("position","relative")}}if(y.sizeStyle=="auto"){E=Math.min(E,l);h=Math.min(h,O);E=E+19;h=h+20}if(y.displayAround=="cursor"){m=J?M.clientX:M.clientX+e(d).scrollLeft()-w;B=J?M.clientY:M.clientY+e(d).scrollTop()-F;A=B+E;G=m+h;if(A>l){if((B-E)<0){if((A-l)<(E-B)){B=l-E;k=-1*k}else{B=0;k=0}}else{B=B-E;k=-1*k}}if(G>O){if((m-h)<0){if((G-O)<(h-m)){m=O-h;q=-1*q}else{m=0;q=0}}else{m=m-h;q=-1*q}}}else{if(y.displayAround=="trigger"){var D=C.outerHeight(true),g=C.outerWidth(true),o=J?C.offset().left-z.scrollLeft():C.offset().left-w,L=J?C.offset().top-z.scrollTop():C.offset().top-F,j=g;m=o+g;B=L;A=B+E;G=m+h;if(A>l){if((B-E)<0){if((A-l)<(E-B)){B=l-E;k=-1*k}else{B=0;k=0}}else{B=B-E+D;k=-1*k}}if(G>O){if((m-h)<0){if((G-O)<(h-m)){m=O-h;q=-1*q;j=-g}else{m=0;q=0;j=0}}else{m=m-h-g;q=-1*q;j=-g}}if(y.position=="top"){E=Math.min(p.menuHeight,L);B=L-E;k=v;m=m-j}else{if(y.position=="left"){h=Math.min(p.menuWidth,o);m=o-h;q=I}else{if(y.position=="bottom"){E=Math.min(p.menuHeight,(l-L-D));B=L+D;k=v;m=m-j}else{if(y.position=="right"){h=Math.min(p.menuWidth,(O-o-g));m=o+g;q=I}}}}}}var H=i.outerWidth(true)-i.width(),s=i.outerHeight(true)-i.height();var N={position:(J||u)?"fixed":"absolute",display:"inline-block",height:"",width:"","overflow-y":E!=p.menuHeight?"auto":"hidden","overflow-x":h!=p.menuWidth?"auto":"hidden"};if(y.sizeStyle=="auto"){N.height=E-s+"px";N.width=h-H+"px"}if(y.left!="auto"){m=c.getPxSize(y.left,O)}if(y.top!="auto"){B=c.getPxSize(y.top,l)}if(!J){var t=C.offsetParent().offset();if(u){m=m+w-e(d).scrollLeft();B=B+F-e(d).scrollTop()}else{m=m-(w-t.left);B=B-(F-t.top)}}N.left=m+q+"px";N.top=B+k+"px";i.css(N);y.afterOpen.call(this,x,M);c.tempTextBox();if(!C.is("input,select,textarea")&&(n.method=="menu")){e("#iw-tempTxt").focus()}if(C.closest(".iw-contextMenu").length==0){e(".iw-curMenu").removeClass("iw-curMenu");i.addClass("iw-curMenu")}var r={trigger:C,menu:i,option:y,method:n.method};e("html").unbind("click",c.clickEvent).click(r,c.clickEvent);e(a.documentElement).unbind("keyup",c.keyEvent).keyup(r,c.keyEvent);if(y.winEventClose){e(d).bind("scroll resize",r,c.scrollEvent)}},scrollEvent:function(g){c.closeContextMenu(g.data.option,g.data.trigger,g.data.menu,g)},clickEvent:function(h){var g=h.data.trigger.get(0);if((g!==h.target)&&(e(h.target).closest(".iw-contextMenu").length==0)){c.closeContextMenu(h.data.option,h.data.trigger,h.data.menu,h)}},keyEvent:function(r){var h=r.data.menu,o=r.data.option,u=r.keyCode;if(u==27){c.closeContextMenu(o,r.data.trigger,h,r)}if(r.data.method=="menu"){var i=e(".iw-curMenu"),p=i.children("li:not(.iw-mDisable)"),l=p.filter(".iw-mSelected"),q=p.index(l),t=function(v){l.removeClass("iw-mSelected");v.addClass("iw-mSelected")},n=function(){t(p.filter(":first"))},s=function(){t(p.filter(":last"))},m=function(){t(p.filter(":eq("+(q+1)+")"))},j=function(){t(p.filter(":eq("+(q-1)+")"))},k=function(){var w=l.data("iw-menuData");if(w){l.triggerHandler("mouseenter.contextMenu");var v=w.menu;v.addClass("iw-curMenu");i.removeClass("iw-curMenu");i=v;p=i.children("li:not(.iw-mDisable)");l=p.filter(".iw-mSelected");n()}},g=function(){var v=i.data("iw-menuData").trigger;var w=v.closest(".iw-contextMenu");if(w.length!=0){i.removeClass("iw-curMenu").css("display","none");w.addClass("iw-curMenu")}};switch(u){case 13:l.click();break;case 40:(q==p.length-1||l.length==0)?n():m();break;case 38:(q==0||l.length==0)?s():j();break;case 33:n();break;case 34:s();break;case 37:g();break;case 39:k();break}}},closeContextMenu:function(h,g,j,i){e(a.documentElement).unbind("keyup",c.keyEvent);e("html").unbind("click",c.clickEvent);e(d).unbind("scroll resize",c.scrollEvent);e(".iw-contextMenu").hide();e(a).focus();e("#iw-tempTxt").remove();h.onClose.call(this,{trigger:g,menu:j},i)},getPxSize:function(g,h){if(!isNaN(g)){return g}if(g.indexOf("%")!=-1){return parseInt(g)*h/100}else{return parseInt(g)}},menuHover:function(g){g.children("li").bind("mouseenter",function(j){e(".iw-curMenu").removeClass("iw-curMenu");g.addClass("iw-curMenu");var i=g.find("li.iw-mSelected"),h=i.find(".iw-contextMenu");if((h.length!=0)&&(i[0]!=this)){h.hide(100)}i.removeClass("iw-mSelected");e(this).addClass("iw-mSelected")})},createMenuList:function(v,h,o){var s=o.baseTrigger,r=Math.floor(Math.random()*10000);if((typeof h=="object")&&(!h.nodeType)&&(!h.jquery)){var u=e('<ul class="iw-contextMenu iw-created iw-cm-menu" id="iw-contextMenu'+r+'"></ul>');for(var n=0;n<h.length;n++){var g=h[n].name,t=h[n].fun,j=h[n].subMenu,m=h[n].img||"",w=h[n].title||"",l=h[n].disable,p=e('<li title="'+w+'">'+g+"</li>");if(m){p.prepend('<img src="'+m+'" align="absmiddle" class="iw-mIcon" />')}if(l=="true"){p.addClass("iw-mDisable")}p.bind("click",t);u.append(p);if(j){p.append('<div class="iw-cm-arrow-right" />');c.subMenu(p,j,s,o)}}if(s.index(v[0])==-1){v.append(u)}else{var q=o.containment==d?"body":o.containment;e(q).append(u)}c.onOff(e("#iw-contextMenu"+r));return"#iw-contextMenu"+r}else{if(e(h).length!=0){var k=e(h);k.removeClass("iw-contextMenuCurrent").addClass("iw-contextMenu iw-cm-menu iw-contextMenu"+r).attr("menuId","iw-contextMenu"+r).css("display","none");k.find("ul").each(function(x,y){var i=e(this),z=i.parent("li");z.append('<div class="iw-cm-arrow-right" />');i.addClass("iw-contextMenuCurrent");c.subMenu(z,".iw-contextMenuCurrent",s,o)});c.onOff(e(".iw-contextMenu"+r));return".iw-contextMenu"+r}}},subMenu:function(i,g,h,j){i.contextMenu("menu",g,{triggerOn:"hover",displayAround:"trigger",position:"auto",baseTrigger:h,containment:j.containment})},onOff:function(g){g.find(".iw-mOverlay").remove();g.find(".iw-mDisable").each(function(){var h=e(this);h.append('<div class="iw-mOverlay"/>');h.find(".iw-mOverlay").bind("click mouseenter",function(i){i.stopPropagation()})})},tempTextBox:function(){var g=e('<input type="text" id="iw-tempTxt" />');g.css({position:"fixed",bottom:"0px",width:"1px","font-size":"1px",outline:"none",border:"0px",left:"0px",opacity:".1",padding:"0px"});e("body").append(g)},optionOtimizer:function(h,g){if(!g){return}if(h=="menu"){if(!g.mouseClick){g.mouseClick="right"}}if((g.mouseClick=="right")&&(g.triggerOn=="click")){g.triggerOn="contextmenu"}if(e.inArray(g.triggerOn,["hover","mouseenter","mouseover","mouseleave","mouseout","focusin","focusout"])!=-1){g.displayAround="trigger"}return g}}})(jQuery,window,document);